<!DOCTYPE html>
<html lang="ja" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>クリエイターポータル | 好きなことで、才能を証明する</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-storage-compat.js"></script>

    <style>
        :root {
            --color-primary: #00A19B;
            --color-primary-dark: #00817B;
            --color-bg: #000000;
            --color-surface: #0f172a; /* slate-900 */
            --color-text: #f8fafc; /* slate-50 */
            --color-text-muted: #94a3b8; /* slate-400 */
        }
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: var(--color-bg);
            color: var(--color-text);
        }
        .glassmorphism-card {
            background: rgba(15, 23, 42, 0.8);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(51, 65, 85, 0.5);
        }
        .text-primary { color: var(--color-primary); }
        .bg-primary { background-color: var(--color-primary); }
        .hover\:bg-primary-dark:hover { background-color: var(--color-primary-dark); }
        .shadow-primary { box-shadow: 0 0 25px 0 rgba(0, 161, 155, 0.35); }
        .active-filter {
            background-color: var(--color-primary);
            color: white;
            box-shadow: 0 4px 14px rgba(0, 161, 155, 0.25);
        }
        .auth-tab-active {
            border-bottom: 2px solid var(--color-primary);
            color: var(--color-text);
        }
        .page-section {
            display: none;
        }
        .page-section.active {
            display: block;
        }
        body[data-logged-in='true'] #hero-cta,
        body[data-logged-in='true'] #final-cta-section {
            display: none !important;
        }
    </style>
</head>
<body data-logged-in="false">

    <header class="sticky top-0 z-50 glassmorphism-card">
        <nav class="container mx-auto px-4 flex justify-between items-center py-4">
            <a href="#home" class="nav-link text-2xl font-bold text-primary" data-page="page-home">Creator Portal</a>
            <div id="nav-right" class="flex items-center gap-6">
                <a href="#quests" class="nav-link text-sm font-semibold text-muted hover:text-white transition-colors" data-page="page-quests">依頼を探す</a>
                <div id="auth-buttons-logged-out" class="flex items-center gap-4">
                    <a href="#login" class="nav-link text-sm font-semibold text-muted hover:text-white transition-colors" data-page="page-login">ログイン</a>
                    <a href="#login-signup" id="signup-btn-header" class="nav-link bg-primary text-white font-bold py-2 px-5 rounded-lg hover:bg-primary-dark transition-colors text-sm shadow-lg shadow-primary/20" data-page="page-login">今すぐ登録</a>
                </div>
                <div id="auth-buttons-logged-in" class="hidden relative">
                    <button id="profile-btn" class="w-10 h-10 bg-slate-700 rounded-full flex items-center justify-center text-white font-bold border-2 border-slate-600 overflow-hidden">
                        <img id="profile-btn-img" src="" class="hidden w-full h-full object-cover">
                        <span id="profile-btn-initial">C</span>
                    </button>
                     <div id="logout-menu" class="hidden absolute right-0 mt-2 w-48 bg-slate-800 rounded-md shadow-lg py-1">
                        <a href="#dashboard" class="nav-link block px-4 py-2 text-sm text-slate-200 hover:bg-slate-700" data-page="page-dashboard">ダッシュボード</a>
                        <a href="#profile" class="nav-link block px-4 py-2 text-sm text-slate-200 hover:bg-slate-700" data-page="page-profile">プロフィール</a>
                        <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-slate-200 hover:bg-slate-700">ログアウト</a>
                    </div>
                </div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4">
        
        <!-- Page: Home -->
        <div id="page-home" class="page-section">
            <section id="hero" class="relative text-center py-24 md:py-32 overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-br from-teal-500/10 via-transparent to-purple-500/10 -z-10"></div>
                <h1 class="text-5xl md:text-7xl font-bold mb-6 leading-tight">その「好き」を、<br><span class="bg-gradient-to-r from-teal-400 to-emerald-400 bg-clip-text text-transparent">才能と収益に。</span></h1>
                <p class="max-w-3xl mx-auto text-muted text-lg md:text-xl mb-10">ここは、あなたの情熱が正当に評価される場所。好きな配信者を公式にサポートし、あなたのスキルを価値に変えよう。</p>
                <div id="hero-cta">
                    <a href="#login-signup" class="nav-link bg-gradient-to-r from-teal-500 to-emerald-500 text-white font-bold py-4 px-10 rounded-xl hover:from-teal-600 hover:to-emerald-600 transition-all duration-300 shadow-2xl shadow-primary/25 hover:scale-105 text-lg inline-block" data-page="page-login">
                        <span class="flex items-center justify-center gap-2">🎬 クリエイター登録 (無料)</span>
                    </a>
                </div>
            </section>

            <section id="about" class="py-20 bg-slate-900/50 rounded-2xl">
                <div class="max-w-7xl mx-auto px-6">
                    <h2 class="text-4xl font-bold text-center mb-16">３ステップで始める新しいクリエイター活動</h2>
                    <div class="grid md:grid-cols-3 gap-8">
                        <div class="text-center p-8 bg-slate-800/50 border border-slate-700 rounded-xl hover:border-primary/50 transition-colors">
                            <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-6 text-primary text-3xl">🎯</div>
                            <h3 class="text-xl font-bold mb-2">1. 依頼を選ぶ</h3>
                            <p class="text-muted">好きな配信者や得意なジャンルから、挑戦したい「依頼（クエスト）」を探そう。</p>
                        </div>
                        <div class="text-center p-8 bg-slate-800/50 border border-slate-700 rounded-xl hover:border-primary/50 transition-colors">
                            <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-6 text-primary text-3xl">🎬</div>
                            <h3 class="text-xl font-bold mb-2">2. 動画を創る</h3>
                            <p class="text-muted">あなたの編集スキルと愛を込めて、最高の切り抜き動画を制作し、提出するだけ。</p>
                        </div>
                        <div class="text-center p-8 bg-slate-800/50 border border-slate-700 rounded-xl hover:border-primary/50 transition-colors">
                            <div class="w-16 h-16 bg-primary/20 rounded-full flex items-center justify-center mx-auto mb-6 text-primary text-3xl">🏆</div>
                            <h3 class="text-xl font-bold mb-2">3. 報酬を得る</h3>
                            <p class="text-muted">動画の成果に応じて、公正な報酬が支払われる。あなたの才能が、目に見える価値に変わる瞬間。</p>
                        </div>
                    </div>
                </div>
            </section>

            <section id="final-cta-section" class="py-20">
                <div class="text-center">
                    <h2 class="text-5xl font-bold mb-6">あなたのスキルは、資産になる。</h2>
                    <p class="text-xl text-muted mb-2">先月のトップクリエイター報酬額</p>
                    <p class="text-6xl font-bold bg-gradient-to-r from-teal-400 to-emerald-400 bg-clip-text text-transparent mb-10">¥213,000</p>
                    <a href="#login-signup" class="nav-link bg-gradient-to-r from-teal-500 to-emerald-500 text-white font-bold py-4 px-10 rounded-xl hover:from-teal-600 hover:to-emerald-600 transition-all duration-300 shadow-2xl shadow-primary/25 hover:scale-105 text-xl inline-block" data-page="page-login">
                        <span class="flex items-center justify-center gap-2">👥 今すぐ無料で登録する</span>
                    </a>
                </div>
            </section>
        </div>

        <!-- Page: Quests -->
        <div id="page-quests" class="page-section py-12">
             <section id="requests">
                <h2 class="text-4xl font-bold text-center mb-4">現在の依頼（クエストボード）</h2>
                <p class="text-center text-muted text-lg mb-12">今、こんな依頼があなたを待っています。</p>
                <div class="flex flex-wrap justify-center gap-3 mb-12">
                    <button class="filter-btn active-filter px-5 py-2 text-sm font-semibold rounded-full transition" data-filter="all">すべて</button>
                    <button class="filter-btn px-5 py-2 text-sm font-semibold rounded-full transition bg-slate-800 hover:bg-slate-700" data-filter="FPS">FPS</button>
                    <button class="filter-btn px-5 py-2 text-sm font-semibold rounded-full transition bg-slate-800 hover:bg-slate-700" data-filter="Horror">ホラー</button>
                    <button class="filter-btn px-5 py-2 text-sm font-semibold rounded-full transition bg-slate-800 hover:bg-slate-700" data-filter="RPG">RPG</button>
                    <button class="filter-btn px-5 py-2 text-sm font-semibold rounded-full transition bg-slate-800 hover:bg-slate-700" data-filter="Chat">雑談</button>
                </div>
                <div id="request-list" class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                </div>
            </section>
        </div>

        <!-- Page: Dashboard -->
        <div id="page-dashboard" class="page-section py-12">
            <section id="dashboard-content">
                <h2 class="text-4xl font-bold mb-4">ようこそ、<span id="creator-name-display" class="text-primary">Creator</span>さん</h2>
                <p class="text-muted text-lg mb-12">あなたの活動状況を確認しましょう。</p>
                <div class="grid md:grid-cols-3 gap-6 mb-8">
                     <div class="p-6 bg-slate-800/50 border border-slate-700 rounded-xl text-center">
                        <p class="text-sm text-muted mb-2 flex items-center justify-center gap-2">💰 今月の報酬額</p>
                        <p class="text-3xl font-bold text-primary">¥75,400</p>
                    </div>
                     <div class="p-6 bg-slate-800/50 border border-slate-700 rounded-xl text-center">
                        <p class="text-sm text-muted mb-2 flex items-center justify-center gap-2">👀 総再生回数</p>
                        <p class="text-3xl font-bold">1,280,300</p>
                    </div>
                     <div class="p-6 bg-slate-800/50 border border-slate-700 rounded-xl text-center">
                        <p class="text-sm text-muted mb-2 flex items-center justify-center gap-2">📈 現在のランキング</p>
                        <p class="text-3xl font-bold">5位</p>
                    </div>
                </div>
                <div class="p-8 bg-slate-800/50 border border-slate-700 rounded-xl mb-12">
                     <h3 class="text-xl font-bold mb-6 flex items-center gap-3">📈 月間報酬額の推移</h3>
                    <div class="chart-container">
                        <canvas id="earningsChart"></canvas>
                    </div>
                </div>
                <div class="bg-slate-900/50 rounded-2xl p-8">
                    <div class="grid lg:grid-cols-2 gap-12">
                        <div>
                            <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">👑 ランキング</h3>
                            <div id="leaderboard" class="space-y-4"></div>
                        </div>
                        <div>
                            <h3 class="text-2xl font-bold mb-6 flex items-center gap-3">🏅 実績バッジ</h3>
                            <div id="achievements" class="grid grid-cols-3 gap-4"></div>
                        </div>
                    </div>
                </div>
            </section>
        </div>

        <!-- Page: Profile -->
        <div id="page-profile" class="page-section py-12">
            <h2 class="text-4xl font-bold mb-12">プロフィール設定</h2>
            <div class="max-w-2xl mx-auto bg-slate-900/50 rounded-2xl p-8 border border-slate-700">
                <form id="profile-form">
                    <div class="flex items-center gap-6 mb-8">
                        <div class="relative">
                            <img id="profile-preview" src="https://placehold.co/128x128/0f172a/94a3b8?text=C" class="w-32 h-32 rounded-full object-cover border-4 border-slate-700">
                            <label for="profile-picture-input" class="absolute bottom-0 right-0 bg-primary rounded-full p-2 cursor-pointer hover:bg-primary-dark">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-white"><path d="M12 20h9a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2H3a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h9z"></path><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line><path d="m9 16 2 2 4-4"></path></svg>
                            </label>
                            <input type="file" id="profile-picture-input" class="hidden" accept="image/*">
                        </div>
                        <div>
                            <h3 id="profile-page-name" class="text-3xl font-bold">Creator</h3>
                            <p class="text-muted">プロフィール情報を更新できます</p>
                        </div>
                    </div>
                    <div class="mb-6">
                        <label for="profile-name-input" class="block text-sm font-medium text-muted mb-2">クリエイター名</label>
                        <input type="text" id="profile-name-input" class="w-full p-3 rounded-md text-black bg-slate-200" required>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-primary-dark">プロフィールを保存</button>
                    <p id="profile-success-message" class="text-green-400 text-center mt-4 hidden">プロフィールを更新しました！</p>
                </form>
            </div>
        </div>

        <!-- Page: Login -->
        <div id="page-login" class="page-section flex items-center justify-center py-20">
            <div class="w-full max-w-md p-8 rounded-2xl relative bg-slate-900 border border-slate-700">
                <div class="text-center mb-6">
                    <h2 class="text-3xl font-bold text-primary">Creator Portal</h2>
                </div>
                <button id="google-login-btn" class="w-full bg-white text-black font-bold py-3 rounded-lg hover:bg-gray-200 flex items-center justify-center gap-2 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" width="20" height="20" viewBox="0 0 48 48">
                    <path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.222,0-9.519-3.357-11.187-7.962l-6.522,5.025C9.505,39.556,16.227,44,24,44z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.082,5.571l6.19,5.238C42.022,35.244,44,30.036,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path>
                    </svg>
                    Googleでログイン
                </button>
                <div class="flex items-center my-4">
                    <hr class="flex-grow border-slate-700">
                    <span class="px-2 text-muted text-sm">または</span>
                    <hr class="flex-grow border-slate-700">
                </div>
                <div class="flex border-b border-slate-700 mb-6">
                    <button id="login-tab" class="auth-tab-active flex-1 py-2 font-semibold">メールアドレスでログイン</button>
                    <button id="signup-tab" class="flex-1 py-2 font-semibold text-muted">新規登録</button>
                </div>
                <form id="login-form">
                    <div class="mb-4">
                        <label for="login-email" class="block text-sm font-medium text-muted mb-1">メールアドレス</label>
                        <input type="email" id="login-email" class="w-full p-2 rounded-md text-black bg-slate-200" required>
                    </div>
                    <div class="mb-6">
                        <label for="login-password" class="block text-sm font-medium text-muted mb-1">パスワード</label>
                        <input type="password" id="login-password" class="w-full p-2 rounded-md text-black bg-slate-200" required>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-primary-dark">ログイン</button>
                </form>
                <form id="signup-form" class="hidden">
                     <div class="mb-4">
                        <label for="signup-name" class="block text-sm font-medium text-muted mb-1">クリエイター名</label>
                        <input type="text" id="signup-name" class="w-full p-2 rounded-md text-black bg-slate-200" required>
                    </div>
                    <div class="mb-4">
                        <label for="signup-email" class="block text-sm font-medium text-muted mb-1">メールアドレス</label>
                        <input type="email" id="signup-email" class="w-full p-2 rounded-md text-black bg-slate-200" required>
                    </div>
                    <div class="mb-4">
                        <label for="signup-password" class="block text-sm font-medium text-muted mb-1">パスワード</label>
                        <input type="password" id="signup-password" class="w-full p-2 rounded-md text-black bg-slate-200" required>
                    </div>
                    <button type="submit" class="w-full bg-primary text-white font-bold py-3 rounded-lg hover:bg-primary-dark">登録する</button>
                </form>
            </div>
        </div>
    </main>

    <footer class="border-t border-slate-800 mt-10">
        <div class="container mx-auto px-4 py-8 text-center text-muted text-sm">
            <p>&copy; 2025 Creator Portal. All Rights Reserved.</p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // --- Firebase Configuration ---
            const firebaseConfig = {
                apiKey: "AIzaSyDbpQFMOxXC6eExvbq3qiMq3wBs9G0MGA8",
                authDomain: "clip-guild.firebaseapp.com",
                projectId: "clip-guild",
                storageBucket: "clip-guild.appspot.com",
                messagingSenderId: "893502331277",
                appId: "1:893502331277:web:7855a177928c8a70fb85c4",
            };

            // --- Initialize Firebase ---
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();
            const storage = firebase.storage();

            // --- State ---
            let chartInstance = null;
            let activeFilter = 'all';
            let currentUser = null;

            // --- Mock Data ---
            const quests = [
                { id: 1, title: "VALORANTの神プレイ集", streamer: "AlphaGamer", budget: "¥30,000", genre: "FPS", description: "VALORANTでの最高のプレイシーンを集めた動画を作成" },
                { id: 2, title: "まったり雑談ハイライト", streamer: "NekoChan", budget: "¥15,000", genre: "Chat", description: "リラックスした雑談の中での面白い瞬間をハイライト" },
                { id: 3, title: "絶叫！新作ホラー実況", streamer: "HorrorKing", budget: "¥50,000", genre: "Horror", description: "新しいホラーゲームでの恐怖リアクションコンピレーション" },
                { id: 4, title: "伝説の剣入手シーン", streamer: "RPGMaster", budget: "¥25,000", genre: "RPG", description: "レアアイテム獲得時のエピックな瞬間を編集" },
                { id: 5, title: "APEX高速キルクリップ", streamer: "SpeedDemon", budget: "¥40,000", genre: "FPS", description: "APEXでの連続キル場面の高速編集動画" },
                { id: 6, title: "視聴者との面白やり取り", streamer: "YurufuwaTalk", budget: "¥18,000", genre: "Chat", description: "チャットとの楽しいやりとりをまとめた動画" }
            ];
            const leaderboardData = [
                { rank: 1, name: "CreatorX", earnings: "¥152,000", medal: "🥇" },
                { rank: 2, name: "ClipMaster", earnings: "¥128,500", medal: "🥈" },
                { rank: 3, name: "EditNinja", earnings: "¥98,000", medal: "🥉" }
            ];
            const achievementsData = [
                { emoji: "🔰", title: "First Clip" }, { emoji: "🔥", title: "100k Views" }, { emoji: "👻", title: "Horror Master" },
                { emoji: "💰", title: "Yen Master" }, { emoji: "🏆", title: "Top Ranker" }, { emoji: "🤝", title: "Supporter" }
            ];

            // --- Element Selectors ---
            const elements = {
                body: document.body,
                pages: document.querySelectorAll('.page-section'),
                navLinks: document.querySelectorAll('.nav-link'),
                loginTab: document.getElementById('login-tab'),
                signupTab: document.getElementById('signup-tab'),
                loginForm: document.getElementById('login-form'),
                signupForm: document.getElementById('signup-form'),
                googleLoginBtn: document.getElementById('google-login-btn'),
                loggedOutUI: document.getElementById('auth-buttons-logged-out'),
                loggedInUI: document.getElementById('auth-buttons-logged-in'),
                profileBtn: document.getElementById('profile-btn'),
                profileBtnImg: document.getElementById('profile-btn-img'),
                profileBtnInitial: document.getElementById('profile-btn-initial'),
                logoutMenu: document.getElementById('logout-menu'),
                logoutBtn: document.getElementById('logout-btn'),
                requestList: document.getElementById('request-list'),
                filterBtns: document.querySelectorAll('.filter-btn'),
                leaderboard: document.getElementById('leaderboard'),
                achievements: document.getElementById('achievements'),
                earningsChartCanvas: document.getElementById('earningsChart'),
                creatorNameDisplay: document.getElementById('creator-name-display'),
                profileForm: document.getElementById('profile-form'),
                profileNameInput: document.getElementById('profile-name-input'),
                profilePageName: document.getElementById('profile-page-name'),
                profilePictureInput: document.getElementById('profile-picture-input'),
                profilePreview: document.getElementById('profile-preview'),
                profileSuccessMessage: document.getElementById('profile-success-message'),
            };

            // --- Page Navigation ---
            function showPage(pageId) {
                if ((pageId === 'page-dashboard' || pageId === 'page-profile') && !currentUser) {
                    showPage('page-login');
                    return;
                }
                elements.pages.forEach(page => page.classList.toggle('active', page.id === pageId));
                if (pageId === 'page-dashboard') renderDashboard();
                if (pageId === 'page-profile') loadProfileData();
                window.scrollTo(0, 0);
            }

            elements.navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.dataset.page;
                    if (pageId) {
                        if (link.href.includes('#login-signup')) {
                            showPage('page-login');
                            showSignupTab();
                        } else {
                            showPage(pageId);
                        }
                    }
                });
            });

            // --- Render Functions ---
            function renderRequests() {
                if (!elements.requestList) return;
                elements.requestList.innerHTML = '';
                const filteredQuests = activeFilter === 'all' ? quests : quests.filter(q => q.genre === activeFilter);
                filteredQuests.forEach(quest => {
                    const card = document.createElement('div');
                    card.className = 'bg-slate-800/50 border border-slate-700 hover:border-primary/50 transition-all duration-300 hover:scale-105 rounded-xl p-6';
                    card.innerHTML = `
                        <div class="flex items-start justify-between mb-4">
                            <span class="bg-primary/20 text-primary border border-primary/30 font-bold text-xs px-2 py-1 rounded-full">${quest.genre}</span>
                            <div class="text-right">
                                <div class="text-sm text-muted">残り予算</div>
                                <div class="text-lg font-bold text-primary">${quest.budget}</div>
                            </div>
                        </div>
                        <h4 class="text-xl font-bold mb-2">${quest.title}</h4>
                        <p class="text-muted mb-3">依頼主: <span class="font-semibold text-slate-300">${quest.streamer}</span></p>
                        <p class="text-sm text-muted leading-relaxed mb-4">${quest.description}</p>
                        <button class="w-full bg-slate-700 hover:bg-primary text-white font-bold py-2 rounded-lg transition-colors">クエストに応募</button>
                    `;
                    elements.requestList.appendChild(card);
                });
            }

            function renderDashboard() {
                if (!elements.leaderboard) return;
                elements.leaderboard.innerHTML = leaderboardData.map(creator => `
                    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4 flex items-center justify-between">
                        <div class="flex items-center gap-4">
                            <span class="text-2xl">${creator.medal}</span>
                            <span class="font-bold text-lg">${creator.rank}. ${creator.name}</span>
                        </div>
                        <span class="text-lg font-bold text-primary">${creator.earnings}</span>
                    </div>
                `).join('');

                elements.achievements.innerHTML = achievementsData.map(ach => `
                    <div class="bg-slate-800/50 border border-slate-700 rounded-lg p-4 text-center hover:border-primary/50 transition-colors">
                        <div class="text-3xl mb-2">${ach.emoji}</div>
                        <h5 class="font-bold text-xs">${ach.title}</h5>
                    </div>
                `).join('');
                
                if (chartInstance) chartInstance.destroy();
                const ctx = elements.earningsChartCanvas.getContext('2d');
                chartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['4月', '5月', '6月', '7月', '8月', '9月'],
                        datasets: [{
                            label: '月間報酬額',
                            data: [35000, 48000, 62000, 55000, 89000, 75400],
                            backgroundColor: 'rgba(0, 161, 155, 0.6)',
                            borderColor: 'rgba(0, 161, 155, 1)',
                            borderWidth: 1,
                            borderRadius: 5,
                            borderSkipped: false,
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: true, grid: { color: '#374151' }, ticks: { color: '#9CA3AF', callback: value => '¥' + value.toLocaleString() } },
                            x: { grid: { display: false }, ticks: { color: '#9CA3AF' } }
                        }
                    }
                });
            }
            
            // --- UI Update & Auth Logic ---
            function updateUI(user) {
                elements.body.dataset.loggedIn = !!user;
                if (user) {
                    elements.loggedOutUI.classList.add('hidden');
                    elements.loggedInUI.classList.remove('hidden');
                    
                    db.collection('users').doc(user.uid).get().then(doc => {
                        if (doc.exists) {
                            const userData = doc.data();
                            const creatorName = userData.creatorName || user.email.split('@')[0];
                            const profilePic = userData.profilePicUrl;

                            if (profilePic) {
                                elements.profileBtnImg.src = profilePic;
                                elements.profileBtnImg.classList.remove('hidden');
                                elements.profileBtnInitial.classList.add('hidden');
                            } else {
                                elements.profileBtnInitial.textContent = creatorName.charAt(0).toUpperCase();
                                elements.profileBtnImg.classList.add('hidden');
                                elements.profileBtnInitial.classList.remove('hidden');
                            }
                            if(elements.creatorNameDisplay) elements.creatorNameDisplay.textContent = creatorName;
                        }
                    });
                } else {
                    elements.loggedOutUI.classList.remove('hidden');
                    elements.loggedInUI.classList.add('hidden');
                }
            }

            function showLoginTab() {
                elements.loginTab.classList.add('auth-tab-active');
                elements.loginTab.classList.remove('text-muted');
                elements.signupTab.classList.remove('auth-tab-active');
                elements.signupTab.classList.add('text-muted');
                elements.loginForm.classList.remove('hidden');
                elements.signupForm.classList.add('hidden');
            }

            function showSignupTab() {
                elements.signupTab.classList.add('auth-tab-active');
                elements.signupTab.classList.remove('text-muted');
                elements.loginTab.classList.remove('auth-tab-active');
                elements.loginTab.classList.add('text-muted');
                elements.signupForm.classList.remove('hidden');
                elements.loginForm.classList.add('hidden');
            }
            
            // --- Firebase Auth Handlers ---
            auth.onAuthStateChanged(user => {
                currentUser = user;
                updateUI(user);
            });

            elements.signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = elements.signupForm.querySelector('#signup-name').value;
                const email = elements.signupForm.querySelector('#signup-email').value;
                const password = elements.signupForm.querySelector('#signup-password').value;
                
                auth.createUserWithEmailAndPassword(email, password)
                    .then(userCredential => {
                        const user = userCredential.user;
                        return db.collection('users').doc(user.uid).set({
                            creatorName: name,
                            email: email,
                        });
                    })
                    .then(() => {
                        showPage('page-home');
                    })
                    .catch(error => alert(error.message));
            });

            elements.loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = elements.loginForm.querySelector('#login-email').value;
                const password = elements.loginForm.querySelector('#login-password').value;
                auth.signInWithEmailAndPassword(email, password)
                    .then(() => {
                        showPage('page-home');
                    })
                    .catch(error => alert(error.message));
            });

            elements.googleLoginBtn.addEventListener('click', () => {
                const provider = new firebase.auth.GoogleAuthProvider();
                auth.signInWithPopup(provider)
                    .then((result) => {
                        const user = result.user;
                        const userRef = db.collection('users').doc(user.uid);
                        return userRef.get().then(doc => {
                            if (!doc.exists) {
                                return userRef.set({
                                    creatorName: user.displayName || user.email.split('@')[0],
                                    email: user.email,
                                    profilePicUrl: user.photoURL
                                });
                            }
                        });
                    })
                    .then(() => {
                        showPage('page-home');
                    })
                    .catch(error => alert(error.message));
            });
            
            elements.logoutBtn.addEventListener('click', (e) => {
                e.preventDefault();
                auth.signOut();
                elements.logoutMenu.classList.add('hidden');
                showPage('page-home');
            });

            // --- Profile Page Logic ---
            function loadProfileData() {
                if (!currentUser) return;
                db.collection('users').doc(currentUser.uid).get().then(doc => {
                    if (doc.exists) {
                        const data = doc.data();
                        elements.profileNameInput.value = data.creatorName;
                        elements.profilePageName.textContent = data.creatorName;
                        if (data.profilePicUrl) {
                            elements.profilePreview.src = data.profilePicUrl;
                        } else {
                            elements.profilePreview.src = `https://placehold.co/128x128/0f172a/94a3b8?text=${data.creatorName.charAt(0).toUpperCase()}`;
                        }
                    }
                });
            }

            elements.profilePictureInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (!file || !currentUser) return;
                
                const storageRef = storage.ref(`profile-pictures/${currentUser.uid}`);
                storageRef.put(file).then(snapshot => {
                    return snapshot.ref.getDownloadURL();
                }).then(downloadURL => {
                    elements.profilePreview.src = downloadURL;
                    return db.collection('users').doc(currentUser.uid).update({
                        profilePicUrl: downloadURL
                    });
                }).then(() => {
                    updateUI(currentUser);
                }).catch(error => alert(error.message));
            });

            elements.profileForm.addEventListener('submit', (e) => {
                e.preventDefault();
                if (!currentUser) return;
                const newName = elements.profileNameInput.value;
                db.collection('users').doc(currentUser.uid).update({
                    creatorName: newName
                }).then(() => {
                    updateUI(currentUser);
                    loadProfileData();
                    elements.profileSuccessMessage.classList.remove('hidden');
                    setTimeout(() => {
                        elements.profileSuccessMessage.classList.add('hidden');
                    }, 3000);
                }).catch(error => alert(error.message));
            });

            // --- Event Listeners ---
            elements.loginTab.addEventListener('click', showLoginTab);
            elements.signupTab.addEventListener('click', showSignupTab);
            
            elements.profileBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                elements.logoutMenu.classList.toggle('hidden');
            });
            document.addEventListener('click', (e) => {
                if (currentUser && !elements.profileBtn.contains(e.target) && !elements.logoutMenu.contains(e.target)) {
                    elements.logoutMenu.classList.add('hidden');
                }
            });

            elements.filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    elements.filterBtns.forEach(b => {
                        b.classList.remove('active-filter');
                        b.classList.add('bg-slate-800', 'hover:bg-slate-700');
                    });
                    this.classList.add('active-filter');
                    this.classList.remove('bg-slate-800', 'hover:bg-slate-700');
                    activeFilter = this.dataset.filter;
                    renderRequests();
                });
            });

            // --- Initial Render ---
            const initialPage = window.location.hash.substring(1) || 'page-home';
            if (initialPage.startsWith('login')) {
                showPage('page-login');
                if (initialPage === 'login-signup') {
                    showSignupTab();
                }
            } else {
                showPage('page-home');
            }
            renderRequests();
        });
    </script>
</body>
</html>
